<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>어썸 복정</title>
    <link rel="icon" type="image/png" href="./img/icon-60x60.png" />
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="  crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?clientId=ZAooYirnD5HsX7SfbG4G&submodules=drawing,visualization"></script>
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.3.1/dist/semantic.min.js"></script>
    <script src="./js/html2canvas/html2canvas.js"></script>
    <script src="./js/data/poi_bokjeong.js"></script>
    <script src="./js/semantic/semantic.js"></script>
    <script src="./js/common/maputils.js"></script>
    <script src="./js/nmapv3/nmap.js"></script>
    <script src="./js/nmapv3/manager.js"></script>
    <script src="./js/nmapv3/test.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.3.1/dist/semantic.min.css">
    <link rel="stylesheet" type="text/css" href="css/base.css" />
</head>
<body>

<div id="heaerContainer">
    <div class="buttonGroup">
        <div id="titleContainer">
            <img id="logo" src="./img/ic_launcher.png" />
            <span style="margin-left: 5px; color: white; ">복정동 생활지도</span><span style="color: white; margin-left: 5px; ">어썸 복정</span>
        </div>
        <button id="addConvenienceStore" class="ui inverted button"><i class="map marker alternate icon"></i>편의점</button>
        <button id="addSupermarket" class="ui inverted button"><i class="map marker alternate icon"></i>마트</button>
        <button id="addChickenRestaurants" class="ui inverted button"><i class="map marker alternate icon"></i>치킨</button>
        <!-- <button id="bokjeingLayer" class="ui primary button"><i class="map outline icon"></i>복정동 행정경계 ON</button> -->
        <button id="removeMarker" class="ui inverted button"><i class="eraser icon"></i>마커삭제</button>
        <button id="downloadScreenshot" class="ui inverted button"><i class="download icon"></i>지도 스크린숏</button>
    </div>
</div>
    
<div id="mainContainer">
    <div id="contents">
        <div id="lnb">
            <div id="accordionMenu" class="ui vertical accordion menu">
              <div class="item" id="panel" >
                <a class="active title bold">
                  <i class="dropdown icon"></i>
                                    지도 설정
                </a>
                <div class="active content">
                  <div class="ui form">
                    <div class="accordionItem">
                        <a class="ui blue label">Layer</a>
                    </div>
                    <div class="accordionItem">
                        <a class="ui label btn100px">자전거도로</a>
                        <div class="ui toggle checkbox floatR">
                          <input id="bicycleLayer" type="checkbox" name="public">
                          <label></label>
                        </div>
                    </div>
                    <div class="accordionItem">
                        <a class="ui label btn100px">지적도</a>
                        <div class="ui toggle checkbox floatR">
                          <input id="cadastralLayer" type="checkbox" name="public">
                          <label></label>
                        </div>
                    </div>
                    <div class="accordionItem">
                        <a class="ui label btn100px">POI</a>
                        <div class="ui toggle checkbox floatR">
                          <input id="labelLayer" type="checkbox" name="public" checked="checked">
                          <label></label>
                        </div>
                    </div>
                    <div class="accordionItem">
                        <a class="ui label btn100px">복정동 행정경계</a>
                        <div class="ui toggle checkbox floatR">
                          <input id="bokjeingLayer" type="checkbox" name="public">
                          <label></label>
                        </div>
                    </div>
                    <div class="accordionItem">
                        <a class="ui blue label">지도컨트롤</a>
                    </div>
                    <div class="accordionItem">
                        <a class="ui label btn100px">지도컨트롤</a>
                        <div class="ui toggle checkbox floatR">
                          <input id="mapControl" type="checkbox" name="public" checked="checked">
                          <label></label>
                        </div>
                    </div>
                    <div class="accordionItem">
                        <a class="ui label btn100px">관성효과</a>
                        <div class="ui toggle checkbox floatR">
                          <input id="kinetic" type="checkbox" name="public" checked="checked">
                          <label></label>
                        </div>
                    </div>
                    <div class="accordionItem">
                        <a class="ui label btn100px">타일 fade in</a>
                        <div class="ui toggle checkbox floatR">
                          <input id="tileTransition" type="checkbox" name="public">
                          <label></label>
                        </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- <div class="item" id="panel" >
                <a class="title bold">
                  <i class="dropdown icon"></i>
                                    그리기도구 스타일 
                </a>
                <div class="content">
                  <div class="ui form">
                    <div class="grouped fields">
                      <div class="field">
                        <div class="ui radio checkbox">
                          <input type="radio" name="size" value="1">
                          <label>가로1줄</label>
                        </div>
                      </div>
                      <div class="field">
                        <div class="ui radio checkbox">
                          <input type="radio" name="size" value="2" checked="checked">
                          <label>세로1줄</label>
                        </div>
                      </div>
                      <div class="field">
                        <div class="ui radio checkbox">
                          <input type="radio" name="size" value="3">
                          <label>가로2줄</label>
                        </div>
                      </div>
                      <div class="field">
                        <div class="ui radio checkbox">
                          <input type="radio" name="size" value="4">
                          <label>세로2줄</label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div> -->
              <div class="item">
                <a class="title bold">
                <i class="dropdown icon"></i>
                                 테스트 기능
                </a>
                <div class="content">
                  <div class="ui form">
                    <div class="accordionItem">
                        <button id="to-seoul" class="ui primary button">panToBounds 서울</button>
                    </div>
                    <div class="accordionItem">
                        <button id="to-bokjeong" class="ui primary button">panTo 복정</button>
                    </div>
                    <div class="accordionItem">
                        <button id="createCardView" class="ui primary button"><i class="map outline icon"></i>카드뷰 추가</button>
                    </div>
                    <div class="accordionItem">
                        <button id="addMarker" class="ui primary button"><i class="map marker alternate icon"></i>테스트마커</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div id="cardContainer">
                <div class="ui cards">
                </div>
            </div>
        </div>
    
        <div id="wrap" class="section">
            <div id="toggleLnb" fold='N'>
                <img alt="" src="./img/arrow-24-16.png">
            </div>
            <div id="map"> 
                <div style="z-index:100; text-align:center; position: absolute; top: 10px; width: 100%;">
                    <div id="latLonDiv">
                        <span id="lat" style="color: black; text-shadow: -1px 0 white, 0 1px white, 1px 0 white, 0 -1px white;"></span>
                        <span id=lon style="color: black; text-shadow: -1px 0 white, 0 1px white, 1px 0 white, 0 -1px white;"></span>
                    </div>
                </div>
                <div style="z-index:100; text-align:center; position: absolute; bottom: 20px; right: 20px;">
                    <span id=zoomLevel style="color: black; text-shadow: -1px 0 white, 0 1px white, 1px 0 white, 0 -1px white;"></span>
                </div>
                <div class="buttons">
                    <!-- <input id="interaction" type="button" name="지도 인터렉션" value="지도 인터렉션" class="control-btn" />
                    <input id="min-max-zoom" type="button" name="최소/최대 줌 레벨" value="최소/최대 줌 레벨: 1 ~ 14" class="control-btn" /> -->
                </div>
            </div>
            <div id="minimap" style="position: absolute; left: 10px; top: 10px; border:solid 2px #333; width:200px;height:200px;"></div>
        </div>
    </div>
</div>

<div class="ui tiny modal">
  <i class="close icon"></i>
  <div class="header">
  </div>
  <div class="image content">
    <div class="ui medium image">
      <img id="infoIcon">
    </div>
    <div class="description">
      <div class="ui header"></div>
      <p id="infoAddress"></p>
    </div>
  </div>
</div>
<script id="code">
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    //+++ Naver Map V3 이벤트 처리 
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    $("#to-seoul").on("click", function(e) {
        panToBounds(map, seoul);
    });

    $("#to-bokjeong").on("click", function(e) {
        panTo(map, bokjeong);
    });

    $('#bicycleLayer').on('change', function() {
        if ($(this).prop('checked')) {
        	showLayer(map, bicycleLayer);
        } else {
        	hideLayer(bicycleLayer);
        }
    })

    $('#cadastralLayer').on('change', function() {
        if ($(this).prop('checked')) {
            showLayer(map, cadastralLayer);
        } else {
        	hideLayer(cadastralLayer);
        }
    })

    $('#labelLayer').on('change', function() {
        if ($(this).prop('checked')) {
        	showLayer(map, labelLayer);
        } else {
        	hideLayer(labelLayer);
        }
    })

    $("#mapControl").on("change", function(e) {
        if ($(this).prop('checked')) {
        	toggleMapControl(map, true);
        } else {
        	toggleMapControl(map, false);
        }
    });

    $("#kinetic").on("change", function(e) {
        if ($(this).prop('checked')) {
        	changeMapOption(map, "disableKineticPan", false);
        } else {
        	changeMapOption(map, "disableKineticPan", true);
        }
    });

    $("#tileTransition").on("change", function(e) {
        if ($(this).prop('checked')) {
            changeMapOption(map, "tileTransition", true);
        } else {
        	changeMapOption(map, "tileTransition", false);
        }
    });

    $("#interaction").on("click", function(e) {
        if (map.getOptions("draggable")) {
        	toggleInteraction(map, false);
        } else {
        	toggleInteraction(map, true);
        }
    });

    $("#min-max-zoom").on("click", function(e) {
        if (map.getOptions("minZoom") === 10) {
            map.setOptions({
                minZoom: 1,
                maxZoom: 14
            });
            $(this).val(this.name + ': 1 ~ 14');
        } else {
            map.setOptions({
                minZoom: 10,
                maxZoom: 12
            });
            $(this).val(this.name + ': 10 ~ 12');
        }
    });
    
    $('#panel input[type=radio]').change(function() {
        drawingManager.setOptions('drawingControlOptions', {style: + this.value});
    });
    
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    //+++ Overlay Convenience Store
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    $("#addConvenienceStore").on("click", function(e) {
        removeMarkerAll();
        $('.ui.cards').empty();
        var latlonArr = [];
        $.each(cuPoiArray, function(index, item) {
            addConvenienceStorePoi(index, item, cuUrl, latlonArr);
        })
        
        $.each(gsPoiArray, function(index, item) {
            addConvenienceStorePoi(index, item, gsUrl, latlonArr);
        })
        
        $.each(sevenPoiArray, function(index, item) {
            addConvenienceStorePoi(index, item, sevenUrl, latlonArr);
        })
        
        map.panToBounds(getLatLngBounds(latlonArr));
    });
    
    $('#removeMarker').on('click', function() {
        this.blur();
        removeMarkerAll();
    });

    
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    //+++ Overlay Simple POI
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    $("#addSupermarket").on("click", function(e) {
        removeMarkerAll();
        $('.ui.cards').empty();
        var latlonArr = [];
        $.each(supermarketPoiArray, function(index, item) {
        	var latLon = new naver.maps.LatLng(item.y, item.x);
            var marker = addImageMarker(item.name, symbolMap.cart, latLon);
            markers.push(marker);
            latlonArr.push(latLon);
            appendCard(item.name, item.address, symbolMap.cart64, item.x, item.y);
            naver.maps.Event.addListener(marker, 'click', function() { 
                $('.ui.tiny.modal').modal('show');
                $('.ui.tiny.modal .header').html(item.name);
                $('#infoIcon').attr('src', symbolMap.cart64);
                $("#infoAddress").html(item.address);
            });
        });
        map.panToBounds(getLatLngBounds(latlonArr));
    });
    
    $("#addChickenRestaurants").on("click", function(e) {
        removeMarkerAll();
        $('.ui.cards').empty();
        var latlonArr = [];
        $.each(chickenPoiArray, function(index, item) {
        	var latLon = new naver.maps.LatLng(item.y, item.x);
            var marker = addImageMarker(item.name, symbolMap.beer, latLon);
            markers.push(marker);
            latlonArr.push(latLon);
            appendCard(item.name, item.address, symbolMap.beer64, item.x, item.y);
            naver.maps.Event.addListener(marker, 'click', function() { 
                $('.ui.tiny.modal').modal('show');
                $('.ui.tiny.modal .header').html(item.name);
                $('#infoIcon').attr('src', symbolMap.beer64);
                $("#infoAddress").html(item.address);
            });
        });
        map.panToBounds(getLatLngBounds(latlonArr));
    });
    
    
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    //+++ Geo Json
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    $('#bokjeingLayer').on('change', function() {
    	requestGeoJson(bokjeongLayer, './data/bokjeong.json', $(this).prop('checked'), function(layer) { bokjeongLayer = layer });
    });
    
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    //+++ ETC
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    $('#downloadScreenshot').on('click', function() {
        html2canvas($('#map')[0], {useCORS: true/* , allowTaint: true */}).then(function(canvas) {
            $('canvas').remove();
            $(document.body).append(canvas);
            //canvas.setAttribute('crossOrigin', 'anonymous');
            var dataURL =canvas.toDataURL('image/jpeg', 1.0);
            dataURL = dataURL.replace(/^data:image\/[^;]*/, 'data:application/octet-stream');
            dataURL = dataURL.replace(/^data:application\/octet-stream/, 'data:application/octet-stream;headers=Content-Disposition%3A%20attachment%3B%20filename=screenshot.jpg');
            var aTag = document.createElement('a');
            aTag.download = 'screenshot.jpg';
            aTag.href = dataURL;
            aTag.click();
        });
    });
    
    $('#toggleLnb').on('click', function() {
    	if ($('#toggleLnb').attr('fold') == 'N') {
    	    $('#toggleLnb').children().css('transform', 'rotate(0deg)');
    	    $('#lnb').css('display','none');
    	    $('#wrap').css('width', '100%');
    	    $('#toggleLnb').attr('fold', 'Y');
    	} else {
    	    $('#toggleLnb').children().css('transform', 'rotate(180deg)');
    	    $('#lnb').css('display','block');
            $('#wrap').css('width', 'calc(100% - 303px)');
    	    $('#toggleLnb').attr('fold', 'N');
    	}
    	resizeMap();
    });
    
    $( window ).resize(function() {
    	resizeMap();
    });
</script>

</body>
</html>
