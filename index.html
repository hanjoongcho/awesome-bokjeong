<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>어썸 복정</title>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="  crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?clientId=ZAooYirnD5HsX7SfbG4G&submodules=drawing,visualization"></script>
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.3.1/dist/semantic.min.js"></script>
    <script src="html2canvas/html2canvas.js"></script>
    <link rel="stylesheet" type="text/css" href="docs/css/examples-base.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.3.1/dist/semantic.min.css">
    <link rel="icon" type="image/png" href="img/icon-60x60.png" />
    <!-- @category Map -->
    <style type="text/css">
    #wrap { display: inline-block; width: calc(100% - 303px); height: calc(100% - 0px); position: absolute; right: 0px;}
    #wrap .buttons { position:absolute;top:0;left:0;z-index:1000;padding:5px; }
    #wrap .buttons .control-btn { margin:0 5px 5px 0; }
    #wrap.section { margin: 0px 0px 0px 0px; }
    #lnb { display: inline-block; margin-top: 0px; height: calc(100% - 0px); border: solid black 0px; position: absolute;}
    .ui.vertical.accordion.menu { width: 300px; }
    .ui.one.cards { width: 200px; margin: auto;}
    .section { padding: 0px; }
    .ui.toggle.checkbox {
        vertical-align: middle;
    }
    body { overflow:hidden; }
    #mainContainer { padding: 5px; height: 100%; }
    #cardContainer { overflow: auto; height: 300px; width: 100%; position: absolute; bottom: 0px; }
    #map { width: calc(100% - 0px); height: calc(100% - 0px); }
    .buttonGroup { margin-bottom: 0px; text-align: right; }
    .accordionItem { margin-top: 5px; }
    .ui.toggle.checkbox.floatR { float: right; }
    .btn100px { width: 120px; text-align: center; }
    .title.bold { font-weight: bold; }
    .ui.blue.label { width: 100%; margin-top: 10px; }
    #heaerContainer { height: 60px; line-height: 60px; vertical-align: middle; }
    #titleContainer { display: inline-block; float: left; }
    #contents { height: calc(100% - 60px); position: relative;}
    .ui.modal>.content>.image+.description { width: 100%; }
    #cardContainer .ui.cards { margin: 0px; }
    #cardContainer .ui.cards>.card>.content>.header:not(.ui) { font-size: 1.0em; }
</style>
</head>
<body>

<div id="mainContainer">
    <div id="heaerContainer">
        <div class="buttonGroup">
            <div id="titleContainer">
                <img src="./img/ic_launcher.png" /> <span style="font-weight: bold; margin-left: 5px;">복정동 생활지도</span><span style="color: blue; font-weight: bold; margin-left: 5px;">어썸 복정</span>
            </div>
            <button id="addMarker" class="ui primary button"><i class="map marker alternate icon"></i>테스트마커</button>
            <button id="addConvenienceStore" class="ui primary button"><i class="map marker alternate icon"></i>편의점</button>
            <!-- <button id="bokjeingLayer" class="ui primary button"><i class="map outline icon"></i>복정동 행정경계 ON</button> -->
            <button id="removeMarker" class="ui red button"><i class="eraser icon"></i>마커삭제</button>
            <button id="downloadScreenshot" class="ui primary button"><i class="download icon"></i>지도 스크린숏</button>
        </div>
    </div>

    <div id="contents">
        <div id="lnb">
            <div id="accordionMenu" class="ui vertical accordion menu">
              <div class="item" id="panel" >
                <a class="active title bold">
                  <i class="dropdown icon"></i>
                                    지도 설정
                </a>
                <div class="active content">
                  <div class="ui form">
                    <div class="accordionItem">
                        <a class="ui blue label">Layer</a>
                    </div>
                    <div class="accordionItem">
                        <a class="ui label btn100px">자전거도로</a>
                        <div class="ui toggle checkbox floatR">
                          <input id="bicycleLayer" type="checkbox" name="public">
                          <label></label>
                        </div>
                    </div>
                    <div class="accordionItem">
                        <a class="ui label btn100px">지적도</a>
                        <div class="ui toggle checkbox floatR">
                          <input id="cadastralLayer" type="checkbox" name="public">
                          <label></label>
                        </div>
                    </div>
                    <div class="accordionItem">
                        <a class="ui label btn100px">POI</a>
                        <div class="ui toggle checkbox floatR">
                          <input id="labelLayer" type="checkbox" name="public" checked="checked">
                          <label></label>
                        </div>
                    </div>
                    <div class="accordionItem">
                        <a class="ui label btn100px">복정동 행정경계</a>
                        <div class="ui toggle checkbox floatR">
                          <input id="bokjeingLayer" type="checkbox" name="public">
                          <label></label>
                        </div>
                    </div>
                    <div class="accordionItem">
                        <a class="ui blue label">지도컨트롤</a>
                    </div>
                    <div class="accordionItem">
                        <a class="ui label btn100px">지도컨트롤</a>
                        <div class="ui toggle checkbox floatR">
                          <input id="mapControl" type="checkbox" name="public" checked="checked">
                          <label></label>
                        </div>
                    </div>
                    <div class="accordionItem">
                        <a class="ui label btn100px">관성효과</a>
                        <div class="ui toggle checkbox floatR">
                          <input id="kinetic" type="checkbox" name="public" checked="checked">
                          <label></label>
                        </div>
                    </div>
                    <div class="accordionItem">
                        <a class="ui label btn100px">타일 fade in</a>
                        <div class="ui toggle checkbox floatR">
                          <input id="tileTransition" type="checkbox" name="public">
                          <label></label>
                        </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="item" id="panel" >
                <a class="title bold">
                  <i class="dropdown icon"></i>
                                    그리기도구 스타일
                </a>
                <div class="content">
                  <div class="ui form">
                    <div class="grouped fields">
                      <div class="field">
                        <div class="ui radio checkbox">
                          <input type="radio" name="size" value="1">
                          <label>가로1줄</label>
                        </div>
                      </div>
                      <div class="field">
                        <div class="ui radio checkbox">
                          <input type="radio" name="size" value="2" checked="checked">
                          <label>세로1줄</label>
                        </div>
                      </div>
                      <div class="field">
                        <div class="ui radio checkbox">
                          <input type="radio" name="size" value="3">
                          <label>가로2줄</label>
                        </div>
                      </div>
                      <div class="field">
                        <div class="ui radio checkbox">
                          <input type="radio" name="size" value="4">
                          <label>세로2줄</label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="item">
                <a class="title bold">
                <i class="dropdown icon"></i>
                                 테스트 기능
                </a>
                <div class="content">
                  <div class="ui form">
                    <div class="accordionItem">
                        <button id="to-seoul" class="ui primary button">panToBounds 서울</button>
                    </div>
                    <div class="accordionItem">
                        <button id="to-bokjeong" class="ui primary button">panTo 복정</button>
                    </div>
                    <div class="accordionItem">
                        <button id="createCardView" class="ui primary button"><i class="map outline icon"></i>카드뷰 추가</button>
                    </div>


                  </div>
                </div>
              </div>
            </div>

            <div id="cardContainer">
                <div class="ui cards">
                </div>
            </div>
        </div>

        <div id="wrap" class="section">
            <div id="map">
                <div style="z-index:100; text-align:center; position: absolute; top: 10px; width: 100%;">
                    <span id=latLon style="color: black; text-shadow: -1px 0 white, 0 1px white, 1px 0 white, 0 -1px white;"></span>
                </div>
                <div style="z-index:100; text-align:center; position: absolute; bottom: 20px; right: 20px;">
                    <span id=zoomLevel style="color: black; text-shadow: -1px 0 white, 0 1px white, 1px 0 white, 0 -1px white;"></span>
                </div>
                <div class="buttons">
                    <!-- <input id="interaction" type="button" name="지도 인터렉션" value="지도 인터렉션" class="control-btn" />
                    <input id="min-max-zoom" type="button" name="최소/최대 줌 레벨" value="최소/최대 줌 레벨: 1 ~ 14" class="control-btn" /> -->

                </div>
            </div>

        </div>
    </div>
</div>

<div class="ui tiny modal">
  <i class="close icon"></i>
  <div class="header">
  </div>
  <div class="image content">
    <div class="ui medium image">
      <img id="infoIcon" src="img/ic_launcher.png">
    </div>
    <div class="description">
      <div class="ui header"></div>
      <p id="infoAddress"></p>
    </div>
  </div>
</div>
<script id="code">
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    //+++ Layer 초기화
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    var jeju = new naver.maps.LatLng(33.3590628, 126.534361),
        busan = new naver.maps.LatLng(35.1797865, 129.0750194),
        dokdo = new naver.maps.LatLngBounds(
                    new naver.maps.LatLng(37.2380651, 131.8562652),
                    new naver.maps.LatLng(37.2444436, 131.8786475)),
        seoul = new naver.maps.LatLngBounds(
                    new naver.maps.LatLng(37.42829747263545, 126.76620435615891),
                    new naver.maps.LatLng(37.7010174173061, 127.18379493229875)),
        bokjeong = new naver.maps.LatLng(37.46561, 127.127075);

    var bicycleLayer = new naver.maps.BicycleLayer();
    var cadastralLayer = new naver.maps.CadastralLayer();
    var labelMapType = new naver.maps.NaverMapTypeOption.getNormalLabelLayer();
    var labelMapTypeRegistry = new naver.maps.MapTypeRegistry({
        'label': labelMapType
    });
    var labelLayer = new naver.maps.Layer('label', labelMapTypeRegistry);

    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    //+++ Map 초기화
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    updateMapSize();
    var map = new naver.maps.Map('map', {
            center: new naver.maps.LatLng(bokjeong), //지도의 초기 중심 좌표
            zoom: 10, //지도의 초기 줌 레벨
            minZoom: 1, //지도의 최소 줌 레벨
            zoomControl: true, //줌 컨트롤의 표시 여부
            zoomControlOptions: { //줌 컨트롤의 옵션
                style: naver.maps.ZoomControlStyle.SMALL,
                position: naver.maps.Position.TOP_RIGHT
            },
            mapTypes: new naver.maps.MapTypeRegistry({
                'normal': naver.maps.NaverMapTypeOption.getVectorMap()
            })
        });

    // map.setOptions("mapTypeControl", true); //지도 유형 컨트롤의 표시 여부
    map.setOptions("disableKineticPan", false);
    map.setOptions("tileTransition", false);
    labelLayer.setMap(map);

    naver.maps.Event.addListener(map, 'bounds_changed', function(bounds) {
    	$('#latLon').html(map.getCenter().y + ", " + map.getCenter().x);
    });

    naver.maps.Event.addListener(map, 'zoom_changed', function(zoom) {
        $('#zoomLevel').html(zoom);
    });


    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    //+++ Manager 초기화
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    var drawingManager = new naver.maps.drawing.DrawingManager({
        map: map,
        drawingControl: [
            naver.maps.drawing.DrawingMode.HAND,
            naver.maps.drawing.DrawingMode.RECTANGLE,
            naver.maps.drawing.DrawingMode.ELLIPSE,
            naver.maps.drawing.DrawingMode.POLYLINE,
            naver.maps.drawing.DrawingMode.ARROWLINE,
            naver.maps.drawing.DrawingMode.POLYGON,
            naver.maps.drawing.DrawingMode.MARKER
        ],
        drawingControlOptions: {
            position: naver.maps.Position.TOP_LEFT,
            style: naver.maps.drawing.DrawingStyle.VERTICAL
        },
        controlPointOptions: {
            anchorPointOptions: {
                radius: 5,
                fillColor: '#ff0000',
                strokeColor: '#0000ff',
                strokeWeight: 2
            },
            midPointOptions: {
                radius: 4,
                fillColor: '#ff0000',
                strokeColor: '#0000ff',
                strokeWeight: 2,
                fillOpacity: 0.5
            }
        },
        rectangleOptions: {
            fillColor: '#ff0000',
            fillOpacity: 0.5,
            strokeWeight: 3,
            strokeColor: '#ff0000'
        },
        ellipseOptions: {
            fillColor: '#ff25dc',
            fillOpacity: 0.5,
            strokeWeight: 3,
            strokeColor: '#ff25dc'
        },
        polylineOptions: { // 화살표 아이콘 계열 옵션은 무시됩니다.
            strokeColor: '#222',
            strokeWeight: 3
        },
        arrowlineOptions: { // startIcon || endIcon 옵션이 없으면 endIcon 을 BLOCK_OPEN 으로 설정합니다.
            endIconSize: 16,
            strokeWeight: 3
        },
        polygonOptions: {
            fillColor: '#ffc300',
            fillOpacity: 0.5,
            strokeWeight: 3,
            strokeColor:'#ffc300'
        },
        markerOptions: {
            icon: {
                content: '<img src="/img/pin_default.png" alt="" ' +
                    'style="margin:0px;padding:0px;border:0px solid transparent;display:block;max-width:none;max-height:none; ' +
                    '-webkit-user-select: none; position: absolute; width: 22px; height: 35px; left: 0px; top: 0px;">',
                size: new naver.maps.Size(22, 35),
                anchor: new naver.maps.Point(11, 35)
            }
        }
    });

    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    //+++ Naver Map V3 이벤트 처리
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    $("#to-seoul").on("click", function(e) {
        e.preventDefault();
        map.panToBounds(seoul);
    });

    $("#to-bokjeong").on("click", function(e) {
        e.preventDefault();
        map.panTo(bokjeong);
    });

    $('#bicycleLayer').on('change', function() {
        if ($('#bicycleLayer').prop('checked')) {
            bicycleLayer.setMap(map);
        } else {
             bicycleLayer.setMap(null);
        }
        // console.log($('#bicycleLayerC').prop('checked'))
    })

    $('#cadastralLayer').on('change', function() {
        if ($('#cadastralLayer').prop('checked')) {
            cadastralLayer.setMap(map);
        } else {
            cadastralLayer.setMap(null);
        }
    })

    $('#labelLayer').on('change', function() {
        if ($('#labelLayer').prop('checked')) {
            labelLayer.setMap(map);
        } else {
            labelLayer.setMap(null);
        }
    })

    //지도 컨트롤
    $("#mapControl").on("change", function(e) {
        if (map.getOptions("scaleControl") && !$(this).prop('checked')) {
            map.setOptions({ //모든 지도 컨트롤 숨기기
                scaleControl: false,
                logoControl: false,
                mapDataControl: false,
                zoomControl: false,
                mapTypeControl: false
            });
        } else {
            map.setOptions({ //모든 지도 컨트롤 보이기
                scaleControl: true,
                logoControl: true,
                mapDataControl: true,
                zoomControl: true,
                mapTypeControl: true
            });
        }
    });

    // 관성 드래깅 옵션
    $("#kinetic").on("change", function(e) {
        if (map.getOptions("disableKineticPan") && $(this).prop('checked')) {
            map.setOptions("disableKineticPan", false); //관성 드래깅 켜기
        } else {
            map.setOptions("disableKineticPan", true); //관성 드래깅 끄기
        }
    });

    // 타일 fadeIn 효과
    $("#tileTransition").on("change", function(e) {
        if (map.getOptions("tileTransition") && !$(this).prop('checked')) {
            map.setOptions("tileTransition", false); //타일 fadeIn 효과 끄기
        } else {
            map.setOptions("tileTransition", true); //타일 fadeIn 효과 켜기
        }
    });

    // 지도 인터랙션 옵션
    $("#interaction").on("click", function(e) {
        e.preventDefault();
        if (map.getOptions("draggable")) {
            map.setOptions({ //지도 인터랙션 끄기
                draggable: false,
                pinchZoom: false,
                scrollWheel: false,
                keyboardShortcuts: false,
                disableDoubleTapZoom: true,
                disableDoubleClickZoom: true,
                disableTwoFingerTapZoom: true
            });

            $(this).removeClass("control-on");
        } else {
            map.setOptions({ //지도 인터랙션 켜기
                draggable: true,
                pinchZoom: true,
                scrollWheel: true,
                keyboardShortcuts: true,
                disableDoubleTapZoom: false,
                disableDoubleClickZoom: false,
                disableTwoFingerTapZoom: false
            });

            $(this).addClass("control-on");
        }
    });

    // min/max 줌 레벨
    $("#min-max-zoom").on("click", function(e) {
        e.preventDefault();

        if (map.getOptions("minZoom") === 10) {
            map.setOptions({
                minZoom: 1,
                maxZoom: 14
            });
            $(this).val(this.name + ': 1 ~ 14');
        } else {
            map.setOptions({
                minZoom: 10,
                maxZoom: 12
            });
            $(this).val(this.name + ': 10 ~ 12');
        }
    });

    $('#panel input[type=radio]').change(function() {
    	drawingManager.setOptions('drawingControlOptions', {style: + this.value});
    });

    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    //+++ 테스트용 마커
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    var MARKER_SPRITE_X_OFFSET = 29,
    MARKER_SPRITE_Y_OFFSET = 50,
    MARKER_SPRITE_POSITION = {
        "A0": [0, 0],
        "B0": [MARKER_SPRITE_X_OFFSET, 0],
        "C0": [MARKER_SPRITE_X_OFFSET*2, 0],
        "D0": [MARKER_SPRITE_X_OFFSET*3, 0],
        "E0": [MARKER_SPRITE_X_OFFSET*4, 0],
        "F0": [MARKER_SPRITE_X_OFFSET*5, 0],
        "G0": [MARKER_SPRITE_X_OFFSET*6, 0],
        "H0": [MARKER_SPRITE_X_OFFSET*7, 0],
        "I0": [MARKER_SPRITE_X_OFFSET*8, 0],

        "A1": [0, MARKER_SPRITE_Y_OFFSET],
        "B1": [MARKER_SPRITE_X_OFFSET, MARKER_SPRITE_Y_OFFSET],
        "C1": [MARKER_SPRITE_X_OFFSET*2, MARKER_SPRITE_Y_OFFSET],
        "D1": [MARKER_SPRITE_X_OFFSET*3, MARKER_SPRITE_Y_OFFSET],
        "E1": [MARKER_SPRITE_X_OFFSET*4, MARKER_SPRITE_Y_OFFSET],
        "F1": [MARKER_SPRITE_X_OFFSET*5, MARKER_SPRITE_Y_OFFSET],
        "G1": [MARKER_SPRITE_X_OFFSET*6, MARKER_SPRITE_Y_OFFSET],
        "H1": [MARKER_SPRITE_X_OFFSET*7, MARKER_SPRITE_Y_OFFSET],
        "I1": [MARKER_SPRITE_X_OFFSET*8, MARKER_SPRITE_Y_OFFSET],

        "A2": [0, MARKER_SPRITE_Y_OFFSET*2],
        "B2": [MARKER_SPRITE_X_OFFSET, MARKER_SPRITE_Y_OFFSET*2],
        "C2": [MARKER_SPRITE_X_OFFSET*2, MARKER_SPRITE_Y_OFFSET*2],
        "D2": [MARKER_SPRITE_X_OFFSET*3, MARKER_SPRITE_Y_OFFSET*2],
        "E2": [MARKER_SPRITE_X_OFFSET*4, MARKER_SPRITE_Y_OFFSET*2],
        "F2": [MARKER_SPRITE_X_OFFSET*5, MARKER_SPRITE_Y_OFFSET*2],
        "G2": [MARKER_SPRITE_X_OFFSET*6, MARKER_SPRITE_Y_OFFSET*2],
        "H2": [MARKER_SPRITE_X_OFFSET*7, MARKER_SPRITE_Y_OFFSET*2],
        "I2": [MARKER_SPRITE_X_OFFSET*8, MARKER_SPRITE_Y_OFFSET*2]
    };

    var markers = [],
    infoWindows = [];

    $("#addMarker").on("click", function(e) {
    	var bounds = map.getBounds(),
        southWest = bounds.getSW(),
        northEast = bounds.getNE(),
        lngSpan = northEast.lng() - southWest.lng(),
        latSpan = northEast.lat() - southWest.lat();

        $(this).addClass('disabled');
         for (var key in MARKER_SPRITE_POSITION) {
            var position = new naver.maps.LatLng(
                southWest.lat() + latSpan * Math.random(),
                southWest.lng() + lngSpan * Math.random());

            var marker = new naver.maps.Marker({
                map: map,
                position: position,
                title: key,
                icon: {
                    url: 'img/sp_pins_spot_v3.png',
                    size: new naver.maps.Size(24, 37),
                    anchor: new naver.maps.Point(12, 37),
                    origin: new naver.maps.Point(MARKER_SPRITE_POSITION[key][0], MARKER_SPRITE_POSITION[key][1])
                },
                zIndex: 100
            });

            var infoWindow = new naver.maps.InfoWindow({
                content: '<div style="width:170px;text-align:center;padding:10px 0px 10px 0px;">The Letter is <b>"'+ key.substr(0, 1) +'"</b>.</div>'
            });

            markers.push(marker);
            infoWindows.push(infoWindow);
        };

        // 해당 마커의 인덱스를 seq라는 클로저 변수로 저장하는 이벤트 핸들러를 반환합니다.
        function getClickHandler(seq) {
            return function(e) {
                var marker = markers[seq],
                    infoWindow = infoWindows[seq];

                if (infoWindow.getMap()) {
                    infoWindow.close();
                } else {
                    infoWindow.open(map, marker);
                }
            }
        }

        for (var i=0, ii=markers.length; i<ii; i++) {
            naver.maps.Event.addListener(markers[i], 'click', getClickHandler(i));
        }
    });

    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    //+++ Overlay Convenience Store
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    var cuPoiArray = [
    	{name: 'CU 동서울대도서관점', address: '경기도 성남시 수정구 복정동 423 동서울대학교 학산도서관', x: 127.1292230, y: 37.4597360},
    	{name: 'CU 복정원룸점', address: '경기도 성남시 수정구 복정동 669', x: 127.1285966, y: 37.4614161},
    	{name: 'CU 복정빌리지점', address: '경기도 성남시 수정구 복정동 652-5', x: 127.1288717, y: 37.4640511},
    	{name: 'CU 복정성공점', address: '경기도 성남시 수정구 복정동 660-8', x: 127.1270250, y: 37.4624596},
    	{name: 'CU 성남복정점', address: '경기도 성남시 수정구 복정동 695-1', x: 127.1275402, y: 37.4560254},
    	{name: 'CU 복정하나점', address: '경기도 성남시 수정구 복정동 645', x: 127.1269675, y: 37.4652563},
    	{name: 'CU 위례우남역점', address: '경기도 성남시 수정구 창곡동 550-5', x: 127.1381279, y: 37.4654968},
    	{name: 'CU 복정으뜸점', address: '경기도 성남시 수정구 복정동 704-4', x: 127.1298521, y: 37.4540048},
    	{name: 'CU 성남복정타운점', address: '경기도 성남시 수정구 복정동 631-15', x: 127.1293548, y: 37.4673763},
    	{name: 'CU 위례프라자점', address: '경기도 성남시 수정구 창곡동 387-2', x: 127.1378650, y: 37.4664320}
    ];
    var gsPoiArray = [
    	{name: 'GS25 복정미소점', address: '경기도 성남시 수정구 복정동 704-11', x: 127.1304631, y: 37.4547189},
    	{name: 'GS25 동서울대점', address: '경기도 성남시 수정구 복정동 686', x: 127.1267924, y: 37.4592078},
    	{name: 'GS25 복정제일점', address: '경기도 성남시 수정구 복정동 715 1층', x: 127.1275540, y: 37.4539580},
    	{name: 'GS25 복정도서관점', address: '경기도 성남시 수정구 복정동 659-15 1층', x: 127.1279417, y: 37.4633777},
    	{name: 'GS25 위례창곡점', address: '경기도 성남시 수정구 창곡동 554-5', x: 127.1383358, y: 37.4661483},
    	{name: 'GS25 위례힐스테이트점', address: '경기도 성남시 수정구 창곡동 415-20', x: 127.1440949, y: 37.4646474},
    	{name: 'GS25 위례타운점', address: '경기도 성남시 수정구 창곡동 537-3', x: 127.1376970, y: 37.4674593},
    	{name: 'GS25 위례성산점', address: '경기도 성남시 수정구 창곡동 569', x: 127.1399583, y: 37.4670498},
    	{name: 'GS25 복정타운점', address: '경기도 성남시 수정구 복정동 639-9 103호', x: 127.1287884, y: 37.4669761},
    	{name: 'GS25 성남금빛점', address: '경기도 성남시 수정구 태평2동 3307-69', x: 127.1379821, y: 37.4471142}
    ];
    var sevenPoiArray = [
    	{name: '세븐일레븐 성남복정중앙점', address: '경기도 성남시 수정구 복정동 686-9', x: 127.1269172, y: 37.4580957},
    	{name: '세븐일레븐 가천대가천관점', address: '경기도 성남시 수정구 복정동 산53 차런대가천관 2층', x: 127.1307015, y: 37.4523915},
    	{name: '세븐일레븐 경원대3호점', address: '경기도 성남시 수정구 복정동 620-2 경원대학교 비젼타워 지상1층 B구역 103호', x: 127.1293340, y: 37.4520673},
    	{name: '세븐일레븐 경원대1호점', address: '경기도 성남시 수정구 복정동 620-2 경원대학교 비젼타워 지하3층 B303-2호', x: 127.1293340, y: 37.4520673},
    	{name: '세븐일레븐 경원대2호점', address: '경기도 성남시 수정구 복정동 620-2 경원대학교 비젼타워 지상1층 A구역 103호', x: 127.1293340, y: 37.4520673},
    	{name: '세븐일레븐 성남위례2호점', address: '경기도 성남시 수정구 창곡동 559 길', x: 127.1363734, y: 37.4657316},
    	{name: '세븐일레븐 위례아롬타워점', address: '경기도 성남시 수정구 창곡동 561-2', x: 127.1406434, y: 37.4648934},
    	{name: '세븐일레븐 성남위례1호점', address: '경기도 성남시 수정구 창곡동 555-1 1층', x: 127.1392187, y: 37.4668693},
    	{name: '세븐일레븐가천대1호점', address: '경기도 성남시 수정구 복정동 623', x: 127.1272269, y: 37.4498198},
    	{name: '세븐일레븐가천대3호점', address: '경기도 성남시 수정구 복정동 620-2', x: 127.1271829, y: 37.4495364}
    ];
    var minX, minY, maxX, maxY;
    $("#addConvenienceStore").on("click", function(e) {
    	var cuUrl = "https://search.pstatic.net/common/?type=ofullfill&size=25x25&src=http%3A%2F%2Fldb.phinf.naver.net%2F20150831_276%2F1441000171607H9qgJ_JPEG%2F146376578437799_0.jpg";
    	var gsUrl = "https://search.pstatic.net/common/?type=ofullfill&size=25x25&src=http%3A%2F%2Fldb.phinf.naver.net%2F20160729_12%2F14697916166913CnBg_JPEG%2Fgs25_image1.jpg";
    	var sevenUrl = "https://search.pstatic.net/common/?type=ofullfill&size=25x25&src=http%3A%2F%2Fldb.phinf.naver.net%2F20160512_248%2F1463013758149jMIK0_JPEG%2F176462497257574_0.jpeg";

    	$.each(cuPoiArray, function(index, item) {
    		addConvenienceStorePoi(index, item, cuUrl);
    	})

    	$.each(gsPoiArray, function(index, item) {
            addConvenienceStorePoi(index, item, gsUrl);
        })

        $.each(sevenPoiArray, function(index, item) {
            addConvenienceStorePoi(index, item, sevenUrl);
        })

    	map.panToBounds(new naver.maps.LatLngBounds(
                new naver.maps.LatLng(minY, minX),
                new naver.maps.LatLng(maxY, maxX))
    	);
    });

    var addConvenienceStorePoi = function(index, item, imageUrl) {
    	if (minX == undefined || item.x < minX) minX = item.x;
        if (minY == undefined || item.y < minY) minY = item.y;
        if (maxX == undefined || item.x > maxX) maxX = item.x;
        if (maxY == undefined || item.y > maxY) maxY = item.y;

        var content = "<div style='border: 1px solid black; width=25px; height=25px;'><img src='" + imageUrl +  "'/></div>";
        var loc = new naver.maps.LatLng(item.y, item.x);
        var marker = new naver.maps.Marker({
                map: map,
                position: loc,
                title: item.name,
                icon: {
                    content: content,
                    size: new naver.maps.Size(25, 25),
                    anchor: new naver.maps.Point(0, 0)
                },
                zIndex: 100
            });
        markers.push(marker);
        appendCard(item.name, item.address, imageUrl);
        naver.maps.Event.addListener(marker, 'click', function() {
            $('.ui.tiny.modal').modal('show');
            $('.ui.tiny.modal .header').html(item.name);
            $('#infoIcon').attr('src', imageUrl.replace('size=25x25', 'size=100x100'));
            $("#infoAddress").html(item.address);
        });
    }

    $('#removeMarker').on('click', function() {
    	this.blur();
    	markers.map(x => x.setMap(null));
	    markers = [];
    });


    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    //+++ Geo Json
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    var tooltip = $('<div style="position:absolute;z-index:1000;padding:5px 10px;background-color:#fff;border:solid 2px #000;font-size:14px;pointer-events:none;display:none;"></div>');
    tooltip.appendTo(map.getPanes().floatPane);
    var bokjeingLayer = null;
    $('#bokjeingLayer').on('change', function() {
        this.blur();
        if (bokjeingLayer == null && $(this).prop('checked')) {
        	$.ajax({
                url: 'docs/data/bokjeong.json',
                success: function(geojson) {
                	/* $('#bokjeingLayer').text("복정동 행정경계 OFF");
                	$('#bokjeingLayer').prepend("<i class=\"map outline icon\"></i>"); */
                    bokjeingLayer = geojson;
                    map.data.setStyle(function(feature) {
                        var styleOptions = {
                            fillColor: '#ff0000',
                            fillOpacity: 0.3,
                            strokeColor: '#ff0000',
                            strokeWeight: 2,
                            strokeOpacity: 0.4
                        };

                        if (feature.getProperty('focus')) {
                            styleOptions.fillOpacity = 0.6;
                            styleOptions.fillColor = '#0f0';
                            styleOptions.strokeColor = '#0f0';
                            styleOptions.strokeWeight = 4;
                            styleOptions.strokeOpacity = 1;
                        }

                        return styleOptions;
                    });

                    map.data.addGeoJson(bokjeingLayer);

                    map.data.addListener('mouseover', function(e) {
                        var feature = e.feature,
                            regionName = feature.getProperty('area1') + ' ' + feature.getProperty('area2') + ' ' + feature.getProperty('area1');

                        tooltip.css({
                            display: '',
                            left: e.offset.x,
                            top: e.offset.y
                        }).text(regionName);

                        map.data.overrideStyle(feature, {
                            fillOpacity: 0.6,
                            strokeWeight: 4,
                            strokeOpacity: 1
                        });
                    });

                    map.data.addListener('mouseout', function(e) {
                        tooltip.hide().empty();
                        map.data.revertStyle();
                    });

                    map.data.addListener('click', function(e) {
                        var feature = e.feature;

                        if (feature.getProperty('focus') !== true) {
                            feature.setProperty('focus', true);
                        } else {
                            feature.setProperty('focus', false);
                        }
                    });
                }
            });
        } else {
        	map.data.removeGeoJson(bokjeingLayer);
        	bokjeingLayer = null;
        	/* $('#bokjeingLayer').text("복정동 행정경계 ON")
        	$('#bokjeingLayer').prepend("<i class=\"map outline icon\"></i>"); */
        }
    });

    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    //+++ ETC
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    $('#downloadScreenshot').on('click', function() {
    	html2canvas($('#map')[0], {useCORS: true/* , allowTaint: true */}).then(function(canvas) {
    		$('canvas').remove();
            $(document.body).append(canvas);
            //canvas.setAttribute('crossOrigin', 'anonymous');
            var dataURL =canvas.toDataURL('image/jpeg', 1.0);
            dataURL = dataURL.replace(/^data:image\/[^;]*/, 'data:application/octet-stream');
            dataURL = dataURL.replace(/^data:application\/octet-stream/, 'data:application/octet-stream;headers=Content-Disposition%3A%20attachment%3B%20filename=screenshot.jpg');
            var aTag = document.createElement('a');
            aTag.download = 'screenshot.jpg';
            aTag.href = dataURL;
            aTag.click();
        });
    });

    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    //+++ Semantic-UI
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    function updateMapSize() {
    	// $('#map').css('height', parseFloat($(document.body).css('height')) - parseFloat($('#heaerContainer').css('height')) - 12);
    }

    function updateCardViewSize() {
    	$('#cardContainer').css('height', parseFloat($('#lnb').css('height')) - parseFloat($('.ui.vertical.accordion.menu').css('height')) - 15);
    }

    $( window ).resize(function() {
    	updateMapSize();
    });

    // $('.ui.accordion').accordion();
    $('.ui.accordion')
    .accordion({
    	onOpen: function() { updateCardViewSize(); },
    	onClose: function() { updateCardViewSize(); }
    });

    $('#createCardView').on('click', function() {
    	this.blur();
    	var infoCard = "<div class='card'>";
        infoCard += "<div class='content'>"
        infoCard += "<img class='right floated mini ui image' src='img/vanagon-1919554_640.jpg'>";
        infoCard += "<div class='header'>";
        infoCard += "Elliot Fu";
        infoCard += "</div>";
        infoCard += "<div class='meta'>";
        infoCard += "Friends of Veronika";
        infoCard += "</div>";
        infoCard += "<div class='description'>";
        infoCard += "Elliot requested permission to view your contact details";
        infoCard += "</div>";
        infoCard += "</div>";
        infoCard += "</div>";
    	for (var i = 0; i < 10; i++) {
        	$('.ui.cards').append(infoCard);
    	}

    	$('.ui.rating').rating();
    });

    function appendCard(name, address, url) {
    	var infoCard = "<div class='card'>";
        infoCard += "<div class='content'>"
        infoCard += "<img class='right floated mini ui image' src='" + url + "'>";
        infoCard += "<div class='header'>";
        infoCard += name;
        infoCard += "</div>";
        infoCard += "<div class='meta'>";
        infoCard += "Friends of Veronika";
        infoCard += "</div>";
        infoCard += "<div class='description'>";
        infoCard += address;
        infoCard += "</div>";
        infoCard += "</div>";
        infoCard += "</div>";
    	$('.ui.cards').append(infoCard);
    }

    //$('#createCardView').trigger('click');
    $('#addConvenienceStore').trigger('click');
    updateCardViewSize();



</script>

</body>
</html>
